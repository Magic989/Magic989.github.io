<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MagicConch's Blog - 鱼相忘乎江湖，人相忘乎道术。</title><meta name="author" content="MagicConch"><meta name="copyright" content="MagicConch"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="孰能相与于无相与，相为于无相为？孰能登天游雾，挠挑无极，相忘以生，无所终穷？">
<meta property="og:type" content="website">
<meta property="og:title" content="MagicConch&#39;s Blog">
<meta property="og:url" content="https://www.magicconch.top/index.html">
<meta property="og:site_name" content="MagicConch&#39;s Blog">
<meta property="og:description" content="孰能相与于无相与，相为于无相为？孰能登天游雾，挠挑无极，相忘以生，无所终穷？">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://oss.magicconch.top/api/raw/?path=/img/avatar.webp">
<meta property="article:author" content="MagicConch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oss.magicconch.top/api/raw/?path=/img/avatar.webp"><link rel="shortcut icon" href="https://oss.magicconch.top/api/raw/?path=/img/favicon.webp"><link rel="canonical" href="https://www.magicconch.top/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-DYGY9QND9W"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-DYGY9QND9W')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-DYGY9QND9W', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MagicConch\'s Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-10-29 21:30:06'
}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7295638336607406" crossorigin="anonymous"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="MagicConch's Blog" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(/img/top_img.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://oss.magicconch.top/api/raw/?path=/img/avatar.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://oss.magicconch.top/zh-CN/"><i class="fa-fw fa-solid fa-cloud"></i><span> Netdisk</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url(/img/top_img.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">MagicConch's Blog</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://oss.magicconch.top/zh-CN/"><i class="fa-fw fa-solid fa-cloud"></i><span> Netdisk</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="site-info"><h1 id="site-title">MagicConch's Blog</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/Magic989" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #FF66FF;"></i></a><a class="social-icon" href="mailto:lintianbin88@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #66CCFF;"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts nc" id="recent-posts"><div class="recent-post-items"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/4ced47dc.html" title="2.1.3.5-回调函数及产品应用">2.1.3.5-回调函数及产品应用</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-12-11T06:58:00.000Z" title="发表于 2023-12-11 14:58:00">2023-12-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">2.1. C语言基础</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/2-1-3-%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%86%85%E6%A0%B8/">2.1.3. 程序架构内核</a></span></div><div class="content"> 程序架构的核心理念或需求 掌握回调函数的作用 掌握回调函数的程序编写 掌握回调函数在产品中的应用   程序结构的核心理念和需求 很多人认为好的程序就是代码紧凑、算法精妙、执行效率高。 这个说法非常片面, 因为这些都是代码的局部特征, 局部写得好不代表代码整体上写得好。而好的架构要以 “大局” 为重, 思维不能局限于当前架构下的产品功能, 还要考虑到以后功能的增加和裁剪。 对于单片机开发来说, 一个好的程序架构至少要达到以下要求：  硬件层和应用层的程序代码分开, 相互之间的控制和通讯使用接口, 不共享全局变量或数组。目的是提升可移植性和可扩展性。  硬件层可以通过 stm32 的库函数打开单片机对应功能来调用, 应用层是产品具体功能的程序代码, 他们之间需要数据的交互（通讯）。 编写较小的项目时, 可以使用全局变量来传输数据。 但是设计较大的项目时, 大量使用全局变量使得代码的可移植性和可拓展性大大降低, 最好是通过接口（函数）来传输数据。 编写 51 单片机代码时, 用一个 .c 文件就可以完成所有功能, 包括寄存器配置、产品功能, 这是没有架构的程序。 编写 stm32...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/ae477bcf.html" title="2.1.3.4-队列算法及产品应用">2.1.3.4-队列算法及产品应用</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-13T13:21:00.000Z" title="发表于 2023-10-13 21:21:00">2023-10-13</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">2.1. C语言基础</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/2-1-3-%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%86%85%E6%A0%B8/">2.1.3. 程序架构内核</a></span></div><div class="content">在算法的学习过程中，应当从功能和原理出发理解代码，而不能从代码出发尝试倒推功能和原理，后者不仅效率极低而且还给人带来挫败感，损伤学习兴趣。  队列的应用场景 循环缓冲区（也被称为环形缓冲区或循环队列）在许多产品和应用中都有着重要的作用，特别是在需要处理数据流的场景中。以下是一些常见的使用案例：  数据流处理: 循环缓冲区常用于处理不断流入的数据，例如网络数据包、串口数据、音视频数据等。循环缓冲区可以保持数据的连续性，并能平滑处理数据流的速率差异（例如，数据的生成速率和处理速率不匹配的情况）。 操作系统: 在操作系统中，循环缓冲区被广泛用于内核和驱动程序，处理如键盘输入、鼠标移动等硬件事件。这些事件由硬件在任何时刻产生，而操作系统需要在适当的时机处理它们。 实时系统: 在实时系统中，循环缓冲区用于处理实时任务，例如传感器数据的收集和处理。实时系统需要快速响应，循环缓冲区可以作为一个&quot;先进先出&quot;（FIFO）的队列，保证数据的实时性。 音频和视频处理:...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/e47a3aac.html" title="2.1.3.3-结构体使用及产品应用">2.1.3.3-结构体使用及产品应用</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-12T01:51:00.000Z" title="发表于 2023-10-12 09:51:00">2023-10-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">2.1. C语言基础</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/2-1-3-%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%86%85%E6%A0%B8/">2.1.3. 程序架构内核</a></span></div><div class="content"> 掌握结构体的概念和用法 掌握结构体数组和结构体指针 掌握结构体的结构体 掌握结构体搭建链表的方法 掌握结构体及链表在产品上的应用  一般的数据类型只能构造同一个类型的数据，但是在不同情况下，我们需要将不同的数据类型组合成一种新的数据结构，比如说像学生的信息包含学生姓名、学号、性别、年龄等信息。那么这些参数里可能有些是数组型、字符型、整型甚至是结构体类型的数据，基于这种需求，结构体就诞生了。结构体就是所谓“面向对象”的编程思想，将某个物体视为一个对象，把这个对象的特性封装在结构体中，用到哪个特性就将其从对象中提取出来。  定义语法 结构体有以下两种定义方式，在中大型产品中往往使用typedef版本，因为这样可以大大提高代码可读性。  标准语法 12345678910111213141516#include &lt;stdio.h&gt;struct Date&#123;    unsigned short year;    unsigned short mon;    unsigned short day;&#125;;int main()&#123;    struct...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/f47db864.html" title="2.1.3.2-指针基础及产品应用">2.1.3.2-指针基础及产品应用</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-04T13:22:00.000Z" title="发表于 2023-10-04 21:22:00">2023-10-04</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">2.1. C语言基础</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/2-1-3-%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%86%85%E6%A0%B8/">2.1.3. 程序架构内核</a></span></div><div class="content">使用指针可以分离硬件层驱动程序(GPIO、串口、定时器)和应用层程序，达到程序分离、提高程序可移植性的目的，但是容易出bug。 1234567891011121314151617181920212223242526272829// Pointer.cpp#include &lt;stdio.h&gt;int main()&#123;    int a;      int *p; //将int*视为一个关键字来理解，这个关键字是为了创建指向int类型数据的指针地址    a = 10;    p = &amp;a;    printf(&quot;//-----------------变量a地址-------------------//\r\n&quot;);    printf(&quot;&amp;a=0x%x\r\n&quot;,&amp;a);    printf(&quot;p=0x%x\r\n&quot;,p);    printf(&quot;&amp;p=0x%x\r\n\r\n&quot;,&amp;p);   ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/642554d6.html" title="2.1.3.1-从typedef和#define的差异理解typedef关键字的使用">2.1.3.1-从typedef和#define的差异理解typedef关键字的使用</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-03T09:25:00.000Z" title="发表于 2023-10-03 17:25:00">2023-10-03</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/">2.1. C语言基础</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/2-1-3-%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%86%85%E6%A0%B8/">2.1.3. 程序架构内核</a></span></div><div class="content"> typedef &lt;原类型&gt; &lt;新类型名&gt;：是一种语句，为已有数据类型取别名。 作用：使代码更加简洁易懂，用typedef定义数组、指针、结构等类型将带来很大的方便，不仅使程序书写简单而且使意义更为明确，因而增强了可读性。   #define &lt;宏名/标识符&gt; &lt;字符串&gt;：是一种预编译指令，在编译前会把源程序中的&lt;宏名/标识符&gt;用对应的&lt;字符串&gt;来替代。  #define 是C中定义的语法，typedef 是 C++ 中定义的语法，二者在C++中可以通用，但 #define 成了预编译指令，typedef 当成语句处理。 Typedef 和 define 都可以用来给对象取一个别名，但是两者却有着很大不同。 参考资料1 参考资料2  执行时间不同 typedef 在编译阶段有效，所以有类型检查的功能，出现变量和数据类型错误时能及时报错。 而 #define 则发生在预处理阶段，只进行简单机械的字符串替换，不进行任何检查，也不占用程序空间(FLASH ROM)。  功能不同  对于 typedef...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/34287.html" title="2.3.3-无线门磁探测器软件设计">2.3.3-无线门磁探测器软件设计</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-30T09:13:00.000Z" title="发表于 2023-09-30 17:13:00">2023-09-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-3-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E4%B8%80%EF%BC%9A%E6%97%A0%E7%BA%BF%E9%97%A8%E7%A3%81%E6%8E%A2%E6%B5%8B%E5%99%A8/">2.3. 实战项目一：无线门磁探测器</a></span></div><div class="content"> 软件开发必要条件  STC 51单片机开发环境 常用的单片机开发环境 Keil、IAR。将STC头文件导入到软件文件夹内。利用STC-ISP中的范例程序进行高效率的开发。  单片机C语言 定义变量的方法 算数逻辑运算符的使用 if、while、for、switch/case、do-while语句 头文件的用途与调用，头文件是硬件和软件关联的关键。 详情见板块“C语言基础”。  无线门磁探测器软件逻辑 门磁探测器软件共可分为四块：IO口初始化配置、门磁开关检测程序设计、低压检测程序设计、射频电路程序设计。 其中，IO口初始化配置并非放在第一步直接完成，应根据模块需求对接口进行配置。 STC15W10X系列芯片如下图所示。   IO口初始化配置  以MCU为核心，看MCU的中英文资料，根据每个接口的用途，确定各个管脚的工作模式，编写初始化代码。 关于IO口的各种模式，此博客中有详细的介绍: GPIO输入输出各种模式详解 12推挽输出能输出大电流，能点亮LED灯。开漏模式省电，可用于接收外部电平变化并进入中断。  所有接口都可利用宏定义进行命名，如下图。  ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/46919.html" title="2.3.2-无线门磁探测器硬件设计">2.3.2-无线门磁探测器硬件设计</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-24T09:44:00.000Z" title="发表于 2023-09-24 17:44:00">2023-09-24</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-3-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E4%B8%80%EF%BC%9A%E6%97%A0%E7%BA%BF%E9%97%A8%E7%A3%81%E6%8E%A2%E6%B5%8B%E5%99%A8/">2.3. 实战项目一：无线门磁探测器</a></span></div><div class="content"> 硬件设计流程   关键物料选型 MCU: STC15W104 干簧管: 磁簧开关(Reed Switch)也称之为干簧管，它是一个通过所施加的磁场操作的电开关。基本型式是将两片磁簧片密封在玻璃管内，两片虽重叠，但中间间隔有一小空隙。当外来磁场时将使两片磁簧片接触，进而导通。 一旦磁体被拉到远离开关，磁簧开关将返回到其原来的位置。 电源模块: &quot;12A&quot;电池 + HT7530稳压管    PCB设计软件(Altium Designer) Altium Designer安装 理解原理图、PCB、原理图库、PCB库。 注意建立完成的工程的后缀对应的文件。 AD设计不是为了电路仿真，是为了导出印刷电路板，电路仿真可以考虑使用Multisim。  无线门磁探测器原理图设计以及绘制 理解visible grid和snap grid。 元件库的建立以及元件库内元件的设计，放置。（设计干簧管） 电磁控制电路和电源电路的讲解，干簧管控制输入电源的电平高低，电源电路采用HT7530将12V电压输出为3V电压。  ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/489f484e.html" title="1.5-利用hexo-abbrlink插件为HEXO博客文章添加永久短链">1.5-利用hexo-abbrlink插件为HEXO博客文章添加永久短链</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-06T03:04:00.000Z" title="发表于 2023-09-06 11:04:00">2023-09-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/1-HEXO/">1. HEXO</a></span></div><div class="content"> 引入 HEXO默认生成的博客链接格式为 “https://{domain}/year/month/day/article_name/” 如果后期需要修改博客标题，会导致原有链接失效，而且中文标题会有非常长的编码，非常不利于分享和搜索引擎收录，所以使用 hexo-abbrlink 插件为HEXO中的每一篇文章编上一个特有的 abbrlink ID ，用这个ID号来识别文章。 通过插件修改后的博客文章链接格式为 “https://{domain}/posts/abbrlink_ID.html” 明显简洁了不少。 接下来举个例子感受一下： 配置插件前的链接： 1https://www.magicconch.top/2023/09/01/2.3.1-%E6%97%A0%E7%BA%BF%E9%97%A8%E7%A3%81%E6%8E%A2%E6%B5%8B%E5%99%A8%E5%BC%80%E5%8F%91%E6%A6%82%E8%A6%81/ 配置插件后的链接： 1https://www.magicconch.top/posts/51745.html 总而言之，使用...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/51745.html" title="2.3.1-无线门磁探测器开发概要">2.3.1-无线门磁探测器开发概要</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-01T13:21:00.000Z" title="发表于 2023-09-01 21:21:00">2023-09-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-3-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E4%B8%80%EF%BC%9A%E6%97%A0%E7%BA%BF%E9%97%A8%E7%A3%81%E6%8E%A2%E6%B5%8B%E5%99%A8/">2.3. 实战项目一：无线门磁探测器</a></span></div><div class="content"> 电子产品开发流程  电子产品立项有以下要点    要点 备注     成本评估 BOM单品成本、开发物料成本、人工成本、时间成本   开发周期评估（开题报告） 开发周期、开发阶段性成果要求   风险评估 技术风险、认证风险等   开发团队的组建 硬件、软件、测试、结构、UI工程师等   …      门磁探测器简单介绍  门磁探测器是用来探测门、窗、抽屉等是否被非法打开或移动的报警器，由门磁主体和永磁体构成。 门磁产品的分类：    类别 通讯方式     有线门磁 485通讯, 开关信号…   无线门磁 ASK, FSK, 蓝牙, WIFI, NB-Iot, Lora等   独立门磁 现场报警提示     门磁探测器开发主要内容   门磁探测器开发需求  产品设计说明 门磁探测器是基于433MHz无线技术开发的安防门窗状态检测探测器，配套市场上众多品牌的安防报警主机使用。 产品支持开关门两种状态检测上报，支持电池低压报警。提供硬件、软件、测试等整体资料，需要配套无线主机使用，只需做简单修改即可。  产品模具与外壳 本产品的外壳选择的是基于携达科技的一款公模外壳。购买方式 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/posts/3252.html" title="2.2.3-单片机外围电路中的重要模块">2.2.3-单片机外围电路中的重要模块</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-08-26T02:41:00.000Z" title="发表于 2023-08-26 10:41:00">2023-08-26</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right article-meta-link"></i><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-2-%E5%8D%95%E7%89%87%E6%9C%BA%E7%A1%AC%E4%BB%B6%E5%9F%BA%E7%A1%80/">2.2. 单片机硬件基础</a></span></div><div class="content"> 常用电源电路    参数 典型值     常用的供电电源 AC220V, DC24V, DC12V, DC9V, DC5V   常用的电池 12V, 9V, 7.4V, 3.7V, 3V, 1.5V, 1.2V等   常用芯片供电电压 5V, 3.3V, 1.8V等   常见的电源芯片 LM1117-5.0 (-3.3V), HT7550(7530), LM7850, LM29302, EL1513E, LM2596    电源设计注意事项：  输入电压 输出电压 输出最大电流 输出电源纹波 其他参数   LED驱动电路 如P2.1所示电路为常规LED驱动电路。LED-WIFI为单片机IO口，当此IO口为低电平时，三极管工作在截止区，LED灯不亮; 反之则反之。  如P2.2所示电路为错误的LED驱动电路。将LED灯直接接在IO口上，看似能实现功能，实际上会产生大电流损坏单片机。   数码管检测电路 led数码管（LED Segment...</div></div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><a class="page-number" href="/page/3/#content-inner">3</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://oss.magicconch.top/api/raw/?path=/img/avatar.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">MagicConch</div><div class="author-info-description">孰能相与于无相与，相为于无相为？<br>孰能登天游雾，挠挑无极，相忘以生，无所终穷？</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" href="mailto:lintianbin88@gmail.com"><i class="fas fa-envelope"></i><span>contact me !</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Magic989" target="_blank" title="GitHub"><i class="fab fa-github" style="color: #FF66FF;"></i></a><a class="social-icon" href="mailto:lintianbin88@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #66CCFF;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;有缘人，你来啦？首先你要开心，其次都是其次！<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;由于本人才疏学浅，难免会有纰漏，如果发现错误，请务必通过 Email 或者文章末尾的评论区联系我。注意: Livere评论系统似乎没有邮件通知, 我可能收不到消息。</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/4ced47dc.html" title="2.1.3.5-回调函数及产品应用">2.1.3.5-回调函数及产品应用</a><time datetime="2023-12-11T06:58:00.000Z" title="发表于 2023-12-11 14:58:00">2023-12-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/ae477bcf.html" title="2.1.3.4-队列算法及产品应用">2.1.3.4-队列算法及产品应用</a><time datetime="2023-10-13T13:21:00.000Z" title="发表于 2023-10-13 21:21:00">2023-10-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/e47a3aac.html" title="2.1.3.3-结构体使用及产品应用">2.1.3.3-结构体使用及产品应用</a><time datetime="2023-10-12T01:51:00.000Z" title="发表于 2023-10-12 09:51:00">2023-10-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/f47db864.html" title="2.1.3.2-指针基础及产品应用">2.1.3.2-指针基础及产品应用</a><time datetime="2023-10-04T13:22:00.000Z" title="发表于 2023-10-04 21:22:00">2023-10-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/642554d6.html" title="2.1.3.1-从typedef和#define的差异理解typedef关键字的使用">2.1.3.1-从typedef和#define的差异理解typedef关键字的使用</a><time datetime="2023-10-03T09:25:00.000Z" title="发表于 2023-10-03 17:25:00">2023-10-03</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
          </div>
          <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/1-HEXO/"><span class="card-category-list-name">1. HEXO</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/"><span class="card-category-list-name">2. 嵌入式</span><span class="card-category-list-count">19</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/"><span class="card-category-list-name">2.1. C语言基础</span><span class="card-category-list-count">13</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/2-1-1-%E4%BA%86%E8%A7%A3%E5%8D%95%E7%89%87%E6%9C%BA/"><span class="card-category-list-name">2.1.1. 了解单片机</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/2-1-2-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/"><span class="card-category-list-name">2.1.2. C语言基本语法</span><span class="card-category-list-count">7</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-1-C%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/2-1-3-%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84%E5%86%85%E6%A0%B8/"><span class="card-category-list-name">2.1.3. 程序架构内核</span><span class="card-category-list-count">5</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-2-%E5%8D%95%E7%89%87%E6%9C%BA%E7%A1%AC%E4%BB%B6%E5%9F%BA%E7%A1%80/"><span class="card-category-list-name">2.2. 单片机硬件基础</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-3-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E4%B8%80%EF%BC%9A%E6%97%A0%E7%BA%BF%E9%97%A8%E7%A3%81%E6%8E%A2%E6%B5%8B%E5%99%A8/"><span class="card-category-list-name">2.3. 实战项目一：无线门磁探测器</span><span class="card-category-list-count">3</span></a></li></ul></li>
          </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/%E7%A1%AC%E4%BB%B6/" style="font-size: 1.1em; color: #999">硬件</a> <a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 1.37em; color: #99a4b2">C语言</a> <a href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/" style="font-size: 1.5em; color: #99a9bf">单片机</a> <a href="/tags/HEXO/" style="font-size: 1.23em; color: #999ea6">HEXO</a> <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 1.5em; color: #99a9bf">嵌入式</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/" style="font-size: 1.1em; color: #999">项目实战</a> <a href="/tags/%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/" style="font-size: 1.23em; color: #999ea6">程序架构</a></div></div><div class="card-widget card-archives">
    <div class="item-headline">
      <i class="fas fa-archive"></i>
      <span>归档</span>
      
    </div>
    <ul class="card-archive-list">
  
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/12/">
          <span class="card-archive-list-date">十二月 2023</span>
          <span class="card-archive-list-count">1</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/10/">
          <span class="card-archive-list-date">十月 2023</span>
          <span class="card-archive-list-count">4</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/09/">
          <span class="card-archive-list-date">九月 2023</span>
          <span class="card-archive-list-count">4</span>
        </a>
      </li>
    
      <li class="card-archive-list-item">
        <a class="card-archive-list-link" href="/archives/2023/08/">
          <span class="card-archive-list-date">八月 2023</span>
          <span class="card-archive-list-count">15</span>
        </a>
      </li>
    </ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站信息</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">24</div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">30.7k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总浏览量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-10-29T13:30:06.043Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background-color: #00000000;"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By MagicConch</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>(() => {
  const panguFn = () => {
    if (typeof pangu === 'object') pangu.autoSpacingPage()
    else {
      btf.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
        .then(() => {
          pangu.autoSpacingPage()
        })
    }
  }

  const panguInit = () => {
    if (false){
      GLOBAL_CONFIG_SITE.isPost && panguFn()
    } else {
      panguFn()
    }
  }

  btf.addGlobalFn('pjaxComplete', panguInit, 'pangu')
  document.addEventListener('DOMContentLoaded', panguInit)
})()</script><div class="js-pjax"><script>window.typedJSFn = {
  init: str => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, null))
  },
  run: subtitleType => {
    if (false) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        btf.getScript('https://cdn.jsdelivr.net/npm/typed.js/dist/typed.umd.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
btf.addGlobalFn('pjaxSendOnce', () => { typed.destroy() }, 'typedDestroy')
</script><script>function subtitleType () {
  if (false) {
    typedJSFn.init(["鱼相忘乎江湖，人相忘乎道术。"])
  } else {
    document.getElementById("subtitle").textContent = "鱼相忘乎江湖，人相忘乎道术。"
  }
}
typedJSFn.run(subtitleType)</script></div><div class="aplayer no-destroy" data-id="8678600084" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-order="random" data-volume="0.3"> </div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: true,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>