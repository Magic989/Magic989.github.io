<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>2.3.2-无线门磁探测器硬件设计 | MagicConch's Blog</title><meta name="author" content="MagicConch"><meta name="copyright" content="MagicConch"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="硬件设计流程   关键物料选型 MCU: STC15W104 干簧管: 磁簧开关(Reed Switch)也称之为干簧管，它是一个通过所施加的磁场操作的电开关。基本型式是将两片磁簧片密封在玻璃管内，两片虽重叠，但中间间隔有一小空隙。当外来磁场时将使两片磁簧片接触，进而导通。 一旦磁体被拉到远离开关，磁簧开关将返回到其原来的位置。 电源模块: &quot;12A&quot;电池 + HT7530稳">
<meta property="og:type" content="article">
<meta property="og:title" content="2.3.2-无线门磁探测器硬件设计">
<meta property="og:url" content="https://www.magicconch.top/posts/46919.html">
<meta property="og:site_name" content="MagicConch&#39;s Blog">
<meta property="og:description" content="硬件设计流程   关键物料选型 MCU: STC15W104 干簧管: 磁簧开关(Reed Switch)也称之为干簧管，它是一个通过所施加的磁场操作的电开关。基本型式是将两片磁簧片密封在玻璃管内，两片虽重叠，但中间间隔有一小空隙。当外来磁场时将使两片磁簧片接触，进而导通。 一旦磁体被拉到远离开关，磁簧开关将返回到其原来的位置。 电源模块: &quot;12A&quot;电池 + HT7530稳">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://oss.magicconch.top/api/raw/?path=/img/avatar.webp">
<meta property="article:published_time" content="2023-09-24T09:44:00.000Z">
<meta property="article:modified_time" content="2023-09-27T13:35:49.580Z">
<meta property="article:author" content="MagicConch">
<meta property="article:tag" content="嵌入式">
<meta property="article:tag" content="单片机">
<meta property="article:tag" content="项目实战">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oss.magicconch.top/api/raw/?path=/img/avatar.webp"><link rel="shortcut icon" href="https://oss.magicconch.top/api/raw/?path=/img/favicon.webp"><link rel="canonical" href="https://www.magicconch.top/posts/46919.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          const mediaQueryDark = window.matchMedia('(prefers-color-scheme: dark)')
          const mediaQueryLight = window.matchMedia('(prefers-color-scheme: light)')
          
          if (theme === undefined) {
            if (mediaQueryLight.matches) activateLightMode()
            else if (mediaQueryDark.matches) activateDarkMode()
            else {
              const hour = new Date().getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            mediaQueryDark.addEventListener('change', () => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else {
            theme === 'light' ? activateLightMode() : activateDarkMode()
          }
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-DYGY9QND9W"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', 'G-DYGY9QND9W')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', 'G-DYGY9QND9W', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2.3.2-无线门磁探测器硬件设计',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7295638336607406" crossorigin="anonymous"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="MagicConch's Blog" type="application/atom+xml">
</head><body><div id="web_bg" style="background-image: url(/img/top_img.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://oss.magicconch.top/api/raw/?path=/img/avatar.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://oss.magicconch.top/zh-CN/"><i class="fa-fw fa-solid fa-cloud"></i><span> Netdisk</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-color: #00000000;"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">MagicConch's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">2.3.2-无线门磁探测器硬件设计</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://oss.magicconch.top/zh-CN/"><i class="fa-fw fa-solid fa-cloud"></i><span> Netdisk</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">2.3.2-无线门磁探测器硬件设计</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-09-24T09:44:00.000Z" title="发表于 2023-09-24 17:44:00">2023-09-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-27T13:35:49.580Z" title="更新于 2023-09-27 21:35:49">2023-09-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/">2. 嵌入式</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/2-%E5%B5%8C%E5%85%A5%E5%BC%8F/2-3-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E4%B8%80%EF%BC%9A%E6%97%A0%E7%BA%BF%E9%97%A8%E7%A3%81%E6%8E%A2%E6%B5%8B%E5%99%A8/">2.3. 实战项目一：无线门磁探测器</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="硬件设计流程"><a class="markdownIt-Anchor" href="#硬件设计流程"></a> 硬件设计流程</h2>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E7%A1%AC%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B.webp" alt="P1.1-硬件设计流程.webp" /></p>
<h2 id="关键物料选型"><a class="markdownIt-Anchor" href="#关键物料选型"></a> 关键物料选型</h2>
<p>MCU: STC15W104<br />
干簧管: 磁簧开关(Reed Switch)也称之为干簧管，它是一个通过所施加的磁场操作的电开关。基本型式是将两片磁簧片密封在玻璃管内，两片虽重叠，但中间间隔有一小空隙。当外来磁场时将使两片磁簧片接触，进而导通。 一旦磁体被拉到远离开关，磁簧开关将返回到其原来的位置。<br />
电源模块: &quot;12A&quot;电池 + HT7530稳压管</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E5%B9%B2%E7%B0%A7%E7%AE%A1.webp" alt="P2.1-干簧管.webp" /></p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E6%88%90%E6%9C%AC%E5%88%9D%E6%AD%A5%E6%A0%B8%E7%AE%97.webp" alt="P2.2-成本初步核算.webp" /></p>
<h2 id="pcb设计软件altium-designer"><a class="markdownIt-Anchor" href="#pcb设计软件altium-designer"></a> PCB设计软件(Altium Designer)</h2>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1GL411V7QP/?from=search&amp;seid=3435152784139761603&amp;spm_id_from=333.337.0.0&amp;vd_source=723bcc95ea546f87d4985cbd117c5454">Altium Designer安装</a></p>
<p>理解原理图、PCB、原理图库、PCB库。<br />
注意建立完成的工程的后缀对应的文件。<br />
AD设计不是为了电路仿真，是为了导出印刷电路板，电路仿真可以考虑使用Multisim。</p>
<h2 id="无线门磁探测器原理图设计以及绘制"><a class="markdownIt-Anchor" href="#无线门磁探测器原理图设计以及绘制"></a> 无线门磁探测器原理图设计以及绘制</h2>
<p>理解visible grid和snap grid。<br />
元件库的建立以及元件库内元件的设计，放置。（设计干簧管）<br />
电磁控制电路和电源电路的讲解，干簧管控制输入电源的电平高低，电源电路采用HT7530将12V电压输出为3V电压。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/DoorSensor%E5%8E%9F%E7%90%86%E5%9B%BE.png" alt="P4.0-DoorSensor原理图.png" /></p>
<h3 id="电源模块"><a class="markdownIt-Anchor" href="#电源模块"></a> 电源模块</h3>
<p>使用23A电池，12V输入电压，应使用HT7530芯片将电压稳定在为3V。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E7%94%B5%E6%BA%90%E6%A8%A1%E5%9D%97.png" alt="P4.1-电源模块.png" /></p>
<h3 id="门磁开关检测模块"><a class="markdownIt-Anchor" href="#门磁开关检测模块"></a> 门磁开关检测模块</h3>
<p>关门状态下，干簧管闭合，GUAN处于低电平，三极管关断，KAI为高电平；开门状态下。干簧管开路，GUAN处于高电平，三极管通路KAI处于低电平。总结：关门时，GUAN下降沿；开门时，KAI下降沿。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E9%97%A8%E7%A3%81%E5%BC%80%E5%85%B3%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9D%97.png" alt="P4.2-门磁开关检测模块.png" /></p>
<h3 id="电池低压检测模块"><a class="markdownIt-Anchor" href="#电池低压检测模块"></a> 电池低压检测模块</h3>
<p>用于检测电池健康度。当电池电压较低时，Q3不导通，Q2导通，Volt_LOW处于低电平；当电池电压较高时，Q3导通，Q2不导通，Volt_LOW处于高电平。总结：当电池电量不足时，Volt_LOW有下降沿。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E7%94%B5%E6%B1%A0%E4%BD%8E%E5%8E%8B%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9D%97.png" alt="P4.3-电池低压检测模块.png" /></p>
<h3 id="射频模块"><a class="markdownIt-Anchor" href="#射频模块"></a> 射频模块</h3>
<p>需要由射频硬件工程师来完成，或者使用现成解决方案。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E5%B0%84%E9%A2%91%E6%A8%A1%E5%9D%97.png" alt="P4.4-射频模块.png" /></p>
<h3 id="mcu电路"><a class="markdownIt-Anchor" href="#mcu电路"></a> MCU电路</h3>
<p>由STC15W104的芯片手册可知INT0、INT1支持上升沿和下降沿中断，INT2、INT3、INT4只支持下降沿中断，以此来确定开门关门以及低压检测所在中断的引脚。并且应当注意单片机烧录引脚不应该加上拉或者下拉电源，可能会导致烧录失败。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/MCU%E7%94%B5%E8%B7%AF.png" alt="P4.5-MCU电路.png" /></p>
<h2 id="印刷电路板pcb绘制"><a class="markdownIt-Anchor" href="#印刷电路板pcb绘制"></a> 印刷电路板(PCB)绘制</h2>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/PCB%E8%AE%BE%E8%AE%A1%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B.webp" alt="P5.1-PCB设计基本流程.webp" /></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1d44y1b7Cc/?from=search&amp;seid=9813390614045852435&amp;spm_id_from=333.337.0.0">基于Altium Designer的PCB绘制</a></p>
<p>概要：</p>
<ol>
<li>建库。画PcbLib与SchLib（可利用<a target="_blank" rel="noopener" href="https://www.szlcsc.com/">立创商城</a>）</li>
<li>绘制原理图。将SchLib内的元件拿出放入到SchDoc，连接元件并检查原理图的正确性</li>
<li>绘制电路图。依据加工厂设计能力设置电路板的极限参数建立规则，将原理图关系导入到电路图中（Pcb与Sch以网表相关联），进行PCB布局布线和PCB规则检查。</li>
</ol>
<h3 id="建库"><a class="markdownIt-Anchor" href="#建库"></a> 建库</h3>
<h4 id="新建工程"><a class="markdownIt-Anchor" href="#新建工程"></a> 新建工程</h4>
<ol>
<li>文件-新的-项目，设置好项目名称和项目文件路径，AD将在对应路径下新建一个与项目名称相同的文件夹放置项目文件。<br />
<img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B(1).png" alt="P5.2-新建工程(1).png" /></li>
<li>在文件夹下新建lib、sch、pcb三个空文件夹。</li>
<li>右键左侧projects栏中对应工程，分别建立SchLib、PcbLib、SchDoc、PcbDoc；将SchLib、PcbLib命名保存到工程目录的lib文件夹内，将SchDoc、PcbDoc命名分别保存到sch与pcb文件夹内。<br />
<img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B(2).png" alt="P5.3-新建工程(2).png" /></li>
</ol>
<h4 id="绘制pcblib"><a class="markdownIt-Anchor" href="#绘制pcblib"></a> 绘制PcbLib</h4>
<p>绘制PcbLib有四个步骤：元件起名、放置引脚、放置丝印、放置3D外框。<br />
打开PCB Library选项卡，进入PcbLib绘制阶段。</p>
<ol>
<li>
<p>元件起名：在封装（FootPrints）栏中右键选择New Blank Footprint，双击器件以编辑。<br />
打开芯片的数据手册，记录芯片引脚之间的最远与最近距离、芯片封装体的长宽高等芯片参数。<br />
tips：画PcbLib类似于画PcbDoc，有层的定义，分为顶层（Top Layer）、底层（Bottom Layer）、机械层（Mechanical Layer）、丝印层（Top Overlay）、通孔层（Multi-Layer）。<font color=red>在绘制框内按G弹出栅格设置。单位切换：按Q在公制（mm）和英制（mil）之间切换，1mil = 0.0254mm。</font>顶层：元器件的引脚（PAD）。丝印层：外框。机械层：3D外形。</p>
</li>
<li>
<p><font color=red>顶层（top layer）放置引脚</font>： 点击place-pad取出焊盘，按tab编辑引脚（或焊盘）属性，设置引脚所在层级为顶层（top layer），Pad Stack中设置焊盘的形状以及长宽（焊盘应当有足够的机械强度）。利用捕获栅格距离的设置，根据具体参数放置各个焊盘。按顺序放置完所有焊盘之后，编辑-设置参考点-中心点。</p>
</li>
<li>
<p><font color=red>丝印层（top overlay）放置芯片外框丝印</font>：用直线画出芯片外框，用豁口标记1引脚位置。</p>
</li>
<li>
<p><font color=red>机械层（mechanical layer）设置3D外形</font>：放置(place) – 3D元件体，右方选项卡中identifier标明器件名称，Board side指的是板面的侧，如果选择顶层（top），则3D元件体垂直纸面向外，选择底层（Bottom）则反之。3D Model Type有四种类型，其中Extruded（柱体）、Cylinder（圆柱体）和Sphere（球体）用于建立一些简单的3D模型，Generic（通用）用于一些形式复杂的器件的导入，一般是AutoCAD中的step文件。</p>
</li>
<li>
<p><font color=red>通孔层（Multi-Layer）</font>：将所有层连接在一起，via就是处于这个层。</p>
</li>
</ol>
<h4 id="绘制schlib"><a class="markdownIt-Anchor" href="#绘制schlib"></a> 绘制SchLib</h4>
<p>画元器件外观以及各个引脚，复制好引脚描述，引脚的电气特性Electrical Type全部设置为Passive，因为不在AD并非电路仿真工具，AD设计只是为了导出电路板。</p>
<h4 id="立创商城移植pcblib与schlib节约建库时间"><a class="markdownIt-Anchor" href="#立创商城移植pcblib与schlib节约建库时间"></a> 立创商城移植PcbLib与SchLib，节约建库时间</h4>
<p>利用立创商城建立一些较复杂的SchLib和PcbLib，然后添加到工程中。</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1wE411E7Lv/?from=search&amp;seid=4696785246416808838&amp;spm_id_from=333.337.0.0&amp;vd_source=723bcc95ea546f87d4985cbd117c5454">立创商城和立创EDA如何将元件库导入Altium Designer为己所用</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1d44y1b7Cc/?p=3&amp;vd_source=723bcc95ea546f87d4985cbd117c5454">极简PCB绘制，立创商城白嫖原理图库和PCB库</a></p>
<p>操作步骤文字描述：</p>
<ol>
<li>在立创商城中搜索所需元器件，选定元器件之后点击数据手册-立即使用。</li>
<li>然后文件-导出Altium Designer，将所选元件的SchDoc与PcbDoc下载。</li>
<li>使用AD打开两个文件，对Sch文件使用Design-Make Schematic Library，生成SchLib，类似操作生成PcbLib。</li>
<li>进入生成的库中，将其中的元器件从左边菜单栏中复制到项目库文件的菜单栏中，至此，移植完毕。</li>
</ol>
<h3 id="原理图绘制"><a class="markdownIt-Anchor" href="#原理图绘制"></a> 原理图绘制</h3>
<h4 id="绘制步骤概述"><a class="markdownIt-Anchor" href="#绘制步骤概述"></a> 绘制步骤概述</h4>
<p>原理图绘制的四个步骤：</p>
<ol>
<li>添加元器件到原理图。</li>
<li>连接元器件，三个步骤：连线、网名、给网名加上示意标识。</li>
<li>元器件编号。</li>
<li>检查原理图。</li>
</ol>
<p>tips：器件按空格旋转，按X/Y镜像翻转。</p>
<h4 id="添加元器件"><a class="markdownIt-Anchor" href="#添加元器件"></a> 添加元器件</h4>
<p>在右侧菜单的“component”选项卡中，选择元器件所在库，将之拖出到SchDoc。</p>
<h4 id="连接元器件"><a class="markdownIt-Anchor" href="#连接元器件"></a> 连接元器件</h4>
<p>按照信号传输方向以及数据手册要求放置元器件。利用线和网名连接各个元器件引脚。<br />
对于两条差分线，应该分别定义网名为“变量名_P”与“变量名_N”并且在两条差分线上放上差分对标示，如下图所示。这样在pcb自动生成的时候，两条差分线将会等长，使高速信号在传输过程中不发生偏差。<br />
在芯片悬空的位置放置“NO ERC”标示，条理清晰，预防报错。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E5%B7%AE%E5%88%86%E7%BA%BF.png" alt="P5.4-差分线.png" /></p>
<h4 id="元器件编号"><a class="markdownIt-Anchor" href="#元器件编号"></a> 元器件编号</h4>
<p>对于有特定名称的元器件，选择直接编辑元器件的Designator。<br />
对于没有特定名称的元器件，形式为 “U?”、“J?”、“C?”… …则使用自动标号，在顶部菜单栏的工具选项卡中选择“标注—原理图标注”，点击“更新更改列表”弹出更改提示框，再点击“接受更改”，验证并执行变更，完成元器件编号。</p>
<h4 id="检查原理图"><a class="markdownIt-Anchor" href="#检查原理图"></a> 检查原理图</h4>
<p>右键工程编译工程，看原理图是否出错，若没有错误则不会弹出提示框。</p>
<h3 id="网表的概念fpga相关"><a class="markdownIt-Anchor" href="#网表的概念fpga相关"></a> 网表的概念（FPGA相关）</h3>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E7%BD%91%E8%A1%A8%E4%BC%A0%E9%80%92%E7%9A%84%E6%B6%88%E6%81%AF.png" alt="P5.5-网表传递的消息.png" /></p>
<p>所谓网表，就是包含了原理图文件中所有连接关系的文字描述文件。其中器件和网络最为重要，不可或缺。<br />
在AD中依次点击“设计(design)—工程网络列表(netlist for project)—protel”，右边目录出现“Generated”选项卡，内部包含一个.NET文件。</p>
<p>网表中的每个单元（元器件）信息用方括号表示，在网表的最前面。<br />
<img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E7%BD%91%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%85%83%E5%99%A8%E4%BB%B6%E4%BF%A1%E6%81%AF.png" alt="P5.6-网表中的元器件信息.png" /></p>
<p>对于人工定义的网络，网络的传递用小括号表示，第一行为网络的名称（人工定义的网名），后面的引脚标号表示了网络中连接的引脚。<br />
<img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E7%BD%91%E8%A1%A8%E4%B8%AD%E4%BA%BA%E5%B7%A5%E5%AE%9A%E4%B9%89%E7%9A%84%E7%BD%91%E7%BB%9C.png" alt="P5.7-网表中人工定义的网络.png" /></p>
<p>对于未人工定义的网络，网络的传递依旧用小括号来表示，与人工定义的网络不同之处：网络名称为自动生成的网名，如图中NETC5_1为自动生成的网名，表示C5的第一个引脚。<br />
<img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E7%BD%91%E8%A1%A8%E4%B8%AD%E6%9C%AA%E4%BA%BA%E5%B7%A5%E5%AE%9A%E4%B9%89%E7%9A%84%E7%BD%91%E7%BB%9C.png" alt="P5.8-网表中未人工定义的网络.png" /></p>
<p>根据网表的内容，我们可以看出引脚的名字（name）并不重要，重要的是引脚的标识符（designator），电路图只认封装和联系关系。<br />
只需拿出封装库与网表文件，就可以在Cadence内设计PCB板。网表文件中包含着各器件的连接关系，不同软件之间的原理图和PCB之间的电路信息传递都通过网表来实现。</p>
<h3 id="pcb绘制"><a class="markdownIt-Anchor" href="#pcb绘制"></a> PCB绘制</h3>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/PCB%E7%BB%98%E5%88%B6%E6%B5%81%E7%A8%8B.png" alt="P5.9-PCB绘制流程.png" /></p>
<h4 id="导入原理图到pcb"><a class="markdownIt-Anchor" href="#导入原理图到pcb"></a> 导入原理图到PCB</h4>
<p>导入原理图到PCB时，若验证变更出错，则尝试直接执行变更。因为验证变更是把原理图生成网表进行一次检查，部分需要二次验证的逻辑无法验证。例如差分线需要验证网名对，一次验证网名必然出错，但是执行变更相当于两次验证网名，差分线得以验证。</p>
<h4 id="建立规则"><a class="markdownIt-Anchor" href="#建立规则"></a> 建立规则</h4>
<h5 id="工厂设计极限设置"><a class="markdownIt-Anchor" href="#工厂设计极限设置"></a> 工厂设计极限设置</h5>
<p>点击“设计—规则”。修改电气指标（Electrical）中线与线的间距（Clearance）；线路指标（Routing）中线宽（Width）、过孔参数（RoutingVias）、差分线路径参数（Differential Pairs Routing）；覆铜规则（Plane）也可能用上。</p>
<h5 id="叠层设计layer-stack-manager用于设计多层板"><a class="markdownIt-Anchor" href="#叠层设计layer-stack-manager用于设计多层板"></a> 叠层设计Layer Stack Manager（用于设计多层板）</h5>
<p>设计（Design）–层叠管理器（Layer Stack Manager）</p>
<p>双层PCB板结构（从上到下）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Top Overlay     （顶层丝印层）--</span><br><span class="line">Top Solder      （顶层阻焊层）--</span><br><span class="line">Top Layer       （顶层信号层）--</span><br><span class="line">Dielectric 1    （电介质层1）-- </span><br><span class="line">Bottom Layer    （底层信号层）-- </span><br><span class="line">Bottom Solder   （底层阻焊层）-- </span><br><span class="line">Bottom Overlay  （底层丝印层）</span><br></pre></td></tr></table></figure>
<blockquote>
<p>tips：电路板一般来讲只有偶数层，因为标准板型为双层板，偶数层的电路板能由多块双层电路板中间增加电介质层堆叠而成。而奇数层往往需要定制电路板，成本较高。</p>
</blockquote>
<p>叠层时注意层级的类型：<br />
Internal Plane为内电层，多层板用于铺VCC铜层和GND地层，不能走信号，生产过程中出光绘胶片时出负胶片。<br />
Signal layer为信号层，用于安装元器件及走线，生产过程中出光绘胶片时出正胶片，在此层出现的线与铜皮都是实际出的板子上的线路与铜皮。</p>
<h4 id="pcb布局"><a class="markdownIt-Anchor" href="#pcb布局"></a> PCB布局</h4>
<p>在PCB布局之前，视图配置(view configuration)是必要的，最小化布局过程中受到的干扰，比如隐藏一些对布局没有帮助的Layer，修改Layer的颜色。<br />
按快捷键L弹出view configuration，或者点击界面右下方“Panels”按钮找到view configuration。如下图，在布局布线过程中，信号层（Top/Bottom Layer）和丝印层（Overlay）最为重要，其他的都可以隐藏。<br />
<img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E8%A7%86%E5%9B%BE%E9%85%8D%E7%BD%AE(view%20configuration).png" alt="P5.10-视图配置(view configuration).png" /></p>
<p>设置完view configuration之后，将元器件按照信号传输方向有逻辑地排列在线路板上，使得元器件之间引线短，同时打开PCB和原理图（“Window—垂直平铺”），按照连接关系布局，PCB板设计90％在于布局，10％在于布线，布局得当，布线就容易。</p>
<p>芯片的去耦电容应该靠近芯片的供电引脚，并且容值越小的电容应该越近。</p>
<h4 id="pcb布线和铺铜"><a class="markdownIt-Anchor" href="#pcb布线和铺铜"></a> PCB布线和铺铜</h4>
<p>PCB布线先布模拟信号线和高速信号线，因为这两者容易受干扰，高速信号线还容易干扰别的电路。在布局时就该考虑到，要让这两种线尽量短。<br />
如果PCB无法布线，则需要删除并回到原理图重新修改。</p>
<p>在PCB中，我们常常选用一整片铜片来连接VCC网络和GND网络，可以起到降低阻抗，减少尖峰信号的作用，因此就有了铺铜操作。<br />
对于电路板铺铜操作，首先需要画出铺铜的区域，右键区域铺铜，如下图。<br />
<img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/PCB%E9%93%BA%E9%93%9C.png" alt="P5.11-PCB铺铜.png" /></p>
<p>选定好铺铜之后，再选择铜皮所连接的网络，如下图</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E8%AE%BE%E7%BD%AE%E9%93%9C%E7%9A%AE%E6%89%80%E5%AF%B9%E5%BA%94%E7%9A%84%E7%BD%91%E7%BB%9C.png" alt="P5.12-设置铜皮所对应的网络.png" /></p>
<p>铺完之后需要查看网络中的点是否都连接在一起，如果有元器件没有连接，则需要重新调整铺铜区域。铺铜往往用于VCC网络和GND网络的连接。</p>
<p>快捷键 “数字小键盘*” 能够在电路板布线时切换层级，过孔(via)是联系Top Layer和Bottom Layer的重要PCB元件。过孔的快速放置方法：交互式布线以线路板Top Layer作为起点，然后按快捷键&quot;*&quot;切换层级，将终点放置在Bottom Layer，则会自动生成过孔(via)。前面的布局必须要得当，不然会被迫设置大量via，每个via中都会有寄生电容和电感，很可能影响电路的正常运行。</p>
<h4 id="规则检查"><a class="markdownIt-Anchor" href="#规则检查"></a> 规则检查</h4>
<p>工具(tool)–设计规则检查(Design Rule Check)–运行DRC(Run Design Rule Check)</p>
<p>出现错误，查看错误内容，此时的问题主要是阻焊(solder)和丝印(silk)的问题了，如下图，打开规则中的manufacturing选项，修改其中有关于silk和solder的设置。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E4%BF%AE%E6%94%B9%E9%98%BB%E7%84%8A(solder)%E5%92%8C%E4%B8%9D%E5%8D%B0(sillk)%E8%AE%BE%E7%BD%AE.png" alt="P5.13-修改阻焊(solder)和丝印(sillk)设置.png" /></p>
<p>如下图，阻焊层裂口(Solder Mask Sliver)表示对象之间的间距最小值，与加工厂工艺水平有关，一般设置为0mm也不会出问题。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E8%AE%BE%E7%BD%AE%E9%98%BB%E7%84%8A%E5%B1%82%E8%A3%82%E5%8F%A3(Solder%20Mask%20Sliver).png" alt="P5.14-设置阻焊层裂口(Solder Mask Sliver).png" /></p>
<p>如下图，焊盘与丝印层的之间的间距(Silk To Mask Clearance)不能过小也不能大，过小会导致丝印在焊盘上，焊盘是光滑的，无法丝印；过大会导致丝印层与元器件的对应关系混乱。一般设置为0.1mm。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E8%AE%BE%E7%BD%AE%E7%84%8A%E7%9B%98%E4%B8%8E%E4%B8%9D%E5%8D%B0%E5%B1%82%E7%9A%84%E4%B9%8B%E9%97%B4%E7%9A%84%E9%97%B4%E8%B7%9D(Silk%20To%20Mask%20Clearance).png" alt="P5.15-设置焊盘与丝印层的之间的间距(Silk To Mask Clearance).png" /></p>
<p>如下图，字符位号与位号之间，位号与芯片外框之间的距离，定义为0.1mm。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E8%AE%BE%E7%BD%AE%E4%B8%9D%E5%8D%B0%E5%B1%82%E6%96%87%E5%AD%97%E5%88%B0%E5%85%B6%E4%BB%96%E4%B8%9D%E5%8D%B0%E5%B1%82%E5%AF%B9%E8%B1%A1%E9%97%B4%E8%B7%9D.png" alt="P5.16-设置丝印层文字到其他丝印层对象间距.png" /></p>
<h4 id="板框大小设定对于有公版外壳的产品需要放在第一步进行"><a class="markdownIt-Anchor" href="#板框大小设定对于有公版外壳的产品需要放在第一步进行"></a> 板框大小设定（对于有公版外壳的产品需要放在第一步进行）</h4>
<p>对于有外壳的产品，其板框大小在外壳确定之后就已经确定了，因此可放在第一步。<br />
设置板框有两种方法：</p>
<ol>
<li>在PCB界面按快捷键“1”，进入机械视图，依次点击“设计（Design）–重新定义板形状（Redefine Board Shape）”，框选出板框的范围。</li>
<li>在Keep-Out Layer（板框层）中画一个矩形框，在view configuration里设置只显示Keep-Out Layer，将之前画的矩形框选中，然后依次点击“设计（Design）–板子形状（Board Shape）–从选择对象中定义（Define from selected objects）”。</li>
</ol>
<p>较为推荐第二种方法。</p>
<h3 id="bom文件整理"><a class="markdownIt-Anchor" href="#bom文件整理"></a> BOM文件整理</h3>
<h4 id="利用ad生成bom表"><a class="markdownIt-Anchor" href="#利用ad生成bom表"></a> 利用AD生成BOM表</h4>
<p>BOM（bill of materials，材料清单）制作<br />
BOM表直接从原理图中导出，因此需要将原理图中的元件名称后加上必要的标识，方便后续采购。<br />
“报告（Reports）-- bill of materials”打开BOM表生成界面，生成BOM表。<br />
调整BOM表格式内容，元器件中文名称、描述（包括value和footprint）、标志（丝印）和数量。贴片和插件分开。</p>
<h4 id="利用脚本生成bom清单推荐"><a class="markdownIt-Anchor" href="#利用脚本生成bom清单推荐"></a> 利用脚本生成BOM清单（推荐）</h4>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12g411F7hJ/">视频教程：AD21生成交互式BOM文件</a></p>
<div style="position: relative; padding: 30% 45%;">
<iframe style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;" src="https://player.bilibili.com/player.html?cid=407833581&aid=505445640&page=1&as_wide=1&high_quality=1&danmaku=0" frameborder="no" scrolling="no"></iframe>
</div>
<p>开源脚本发布地址：<a target="_blank" rel="noopener" href="https://github.com/lianlian33/InteractiveHtmlBomForAD/releases">Releases · lianlian33/InteractiveHtmlBomForAD (github.com)</a><br />
下载脚本文件，到设置的“scripting system”中选择脚本目录中的.PrjScr文件导入，点击脚本文件夹中的Initialize.bat进行初始化操作，至此，脚本安装完成。<br />
在AD中打开.PcbDoc文件，上方菜单栏中选择文件选项卡中的运行脚本选项，选择mainWin.js中的startWin运行。如右图中设置，点击“GenerateBom”生成BOMhtml文件。</p>
<p><img src="https://oss.magicconch.top/api/raw/?path=/img/2.3.2/%E8%84%9A%E6%9C%AC%E7%94%9F%E6%88%90BOM%E6%B8%85%E5%8D%95.png" alt="P5.17-脚本生成BOM清单.png" /></p>
<h3 id="打板文件的输出"><a class="markdownIt-Anchor" href="#打板文件的输出"></a> 打板文件的输出</h3>
<p>不涉及机密的电路板，可以直接将.PcbDoc发给厂商进行生产。<br />
涉及到机密的电路板，一般先转换成Gerber文件再发给厂商，实际上厂商要进行电路板制造的话，也是需要先将PCB文件转换为Gerber文件再进行生产。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lin5103151/article/details/89600860">PCB加工文件—Gerber文件的导出</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.magicconch.top">MagicConch</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.magicconch.top/posts/46919.html">https://www.magicconch.top/posts/46919.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://www.magicconch.top" target="_blank">MagicConch's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/">嵌入式</a><a class="post-meta__tags" href="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/">单片机</a><a class="post-meta__tags" href="/tags/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98/">项目实战</a></div><div class="post-share"><div class="social-share" data-image="https://oss.magicconch.top/api/raw/?path=/img/avatar.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/34287.html" title="2.3.3-无线门磁探测器软件设计"><div class="cover" style="background: #00000000"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">2.3.3-无线门磁探测器软件设计</div></div><div class="info-2"><div class="info-item-1"> 软件开发必要条件  STC 51单片机开发环境 常用的单片机开发环境 Keil、IAR。将STC头文件导入到软件文件夹内。利用STC-ISP中的范例程序进行高效率的开发。  单片机C语言 定义变量的方法 算数逻辑运算符的使用 if、while、for、switch/case、do-while语句 头文件的用途与调用，头文件是硬件和软件关联的关键。 详情见板块“C语言基础”。  无线门磁探测器软件逻辑 门磁探测器软件共可分为四块：IO口初始化配置、门磁开关检测程序设计、低压检测程序设计、射频电路程序设计。 其中，IO口初始化配置并非放在第一步直接完成，应根据模块需求对接口进行配置。 STC15W10X系列芯片如下图所示。   IO口初始化配置  以MCU为核心，看MCU的中英文资料，根据每个接口的用途，确定各个管脚的工作模式，编写初始化代码。 关于IO口的各种模式，此博客中有详细的介绍: GPIO输入输出各种模式详解 12推挽输出能输出大电流，能点亮LED灯。开漏模式省电，可用于接收外部电平变化并进入中断。  所有接口都可利用宏定义进行命名，如下图。  ...</div></div></div></a><a class="pagination-related" href="/posts/489f484e.html" title="1.5-利用hexo-abbrlink插件为HEXO博客文章添加永久短链"><div class="cover" style="background: #00000000"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">1.5-利用hexo-abbrlink插件为HEXO博客文章添加永久短链</div></div><div class="info-2"><div class="info-item-1"> 引入 HEXO默认生成的博客链接格式为 “https://{domain}/year/month/day/article_name/” 如果后期需要修改博客标题，会导致原有链接失效，而且中文标题会有非常长的编码，非常不利于分享和搜索引擎收录，所以使用 hexo-abbrlink 插件为HEXO中的每一篇文章编上一个特有的 abbrlink ID ，用这个ID号来识别文章。 通过插件修改后的博客文章链接格式为 “https://{domain}/posts/abbrlink_ID.html” 明显简洁了不少。 接下来举个例子感受一下： 配置插件前的链接： 1https://www.magicconch.top/2023/09/01/2.3.1-%E6%97%A0%E7%BA%BF%E9%97%A8%E7%A3%81%E6%8E%A2%E6%B5%8B%E5%99%A8%E5%BC%80%E5%8F%91%E6%A6%82%E8%A6%81/ 配置插件后的链接： 1https://www.magicconch.top/posts/51745.html 总而言之，使用...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/51745.html" title="2.3.1-无线门磁探测器开发概要"><div class="cover" style="background: #00000000"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-01</div><div class="info-item-2">2.3.1-无线门磁探测器开发概要</div></div><div class="info-2"><div class="info-item-1"> 电子产品开发流程  电子产品立项有以下要点    要点 备注     成本评估 BOM单品成本、开发物料成本、人工成本、时间成本   开发周期评估（开题报告） 开发周期、开发阶段性成果要求   风险评估 技术风险、认证风险等   开发团队的组建 硬件、软件、测试、结构、UI工程师等   …      门磁探测器简单介绍  门磁探测器是用来探测门、窗、抽屉等是否被非法打开或移动的报警器，由门磁主体和永磁体构成。 门磁产品的分类：    类别 通讯方式     有线门磁 485通讯, 开关信号…   无线门磁 ASK, FSK, 蓝牙, WIFI, NB-Iot, Lora等   独立门磁 现场报警提示     门磁探测器开发主要内容   门磁探测器开发需求  产品设计说明 门磁探测器是基于433MHz无线技术开发的安防门窗状态检测探测器，配套市场上众多品牌的安防报警主机使用。 产品支持开关门两种状态检测上报，支持电池低压报警。提供硬件、软件、测试等整体资料，需要配套无线主机使用，只需做简单修改即可。  产品模具与外壳 本产品的外壳选择的是基于携达科技的一款公模外壳。购买方式 ...</div></div></div></a><a class="pagination-related" href="/posts/34287.html" title="2.3.3-无线门磁探测器软件设计"><div class="cover" style="background: #00000000"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-30</div><div class="info-item-2">2.3.3-无线门磁探测器软件设计</div></div><div class="info-2"><div class="info-item-1"> 软件开发必要条件  STC 51单片机开发环境 常用的单片机开发环境 Keil、IAR。将STC头文件导入到软件文件夹内。利用STC-ISP中的范例程序进行高效率的开发。  单片机C语言 定义变量的方法 算数逻辑运算符的使用 if、while、for、switch/case、do-while语句 头文件的用途与调用，头文件是硬件和软件关联的关键。 详情见板块“C语言基础”。  无线门磁探测器软件逻辑 门磁探测器软件共可分为四块：IO口初始化配置、门磁开关检测程序设计、低压检测程序设计、射频电路程序设计。 其中，IO口初始化配置并非放在第一步直接完成，应根据模块需求对接口进行配置。 STC15W10X系列芯片如下图所示。   IO口初始化配置  以MCU为核心，看MCU的中英文资料，根据每个接口的用途，确定各个管脚的工作模式，编写初始化代码。 关于IO口的各种模式，此博客中有详细的介绍: GPIO输入输出各种模式详解 12推挽输出能输出大电流，能点亮LED灯。开漏模式省电，可用于接收外部电平变化并进入中断。  所有接口都可利用宏定义进行命名，如下图。  ...</div></div></div></a><a class="pagination-related" href="/posts/32138.html" title="2.1.2.1-C语言中变量的定义与应用"><div class="cover" style="background: #00000000"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-18</div><div class="info-item-2">2.1.2.1-C语言中变量的定义与应用</div></div><div class="info-2"><div class="info-item-1"> 变量的概念 变量(官方定义)：是用来存储单片机/计算机系统中 计算的过程或结果数值的一个抽象概念 变量：就是一种在程序执行过程中其值不断变化的量。 常量：就是其定义之后数值不会变化的量  变量的数据类型     类型 适用范围 定义方法     布尔型 （bool）1-真 0-假 常用bit ,用bool和bit都能定义。   字符型 1byte，8个bit char   整数型 整数型与字符型存储的数据长度不一样 int、short、long   浮点型 小数 float、double    不同单片机中不同的数据类型所对应的位数也有所不同。 在stm32中，short为16bit，int和long为32bit。 对于有符号的数据类型，最高位表示正负，1为负，0为正。 单片机变量定义及其范围：    数据类型 关键字 所占位数 表示数的范围     无符号字符型 unsigned char 8 0 ~ 255   有符号字符型 char 8 -128 ~ 127   无符号整型 unsigned int 16 0 ~ 65535   有符号整型 int 16 -32768...</div></div></div></a><a class="pagination-related" href="/posts/41825.html" title="2.1.2.2-C语言中运算符的定义与应用"><div class="cover" style="background: #00000000"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-18</div><div class="info-item-2">2.1.2.2-C语言中运算符的定义与应用</div></div><div class="info-2"><div class="info-item-1"> C语言算数运算符    运算符 名称     + 加法运算符   - 减法运算符   * 乘法运算符   / 除法运算符   % 求余运算符   ++ 自增运算符   – 自减运算符    a和a的不同： 1a++是先参与运算再自增，++a反之。  C语言关系运算符    运算符 名称 备注     &gt; 大于    &lt; 小于    &gt;= 大于等于 常见错误：=&gt;   &lt;= 小于等于 常见错误：=&lt;   == 等于    != 不等于     特别说明： 12=   表示的是赋值==  判断功能  关系运算符的使用 在关系运算中，0为假，其他数字都为真。  一般情况下配合if语句使用 1234if(关系运算符的表达式)&#123;    //语句1&#125; 如果关系运算符为真  则执行语句1 关系运算符的表达式成立  -&gt;  运算结果为真    -&gt;  返回1   -&gt;  执行语句1 关系运算符的表达式不成立    -&gt;  运算结果为假  -&gt;  返回0 -&gt;  不执行语句1 ...</div></div></div></a><a class="pagination-related" href="/posts/45612.html" title="2.1.1.1-单片机基本理解"><div class="cover" style="background: #00000000"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-18</div><div class="info-item-2">2.1.1.1-单片机基本理解</div></div><div class="info-2"><div class="info-item-1">很长一段时间以来在word上记了一些笔记，但却一直没能回头复习。再三斟酌，决定将笔记以博客的形式写出来，并借此机会对所学内容进行一次复习，我想应该不用太多时间就能搬运完。 C语言基础将从单片机开始写，直接学习C语言未免过于乏味，但如果通过C语言在单片机上的应用来间接学习C语言，就能让理论与实际充分结合，达到事半功倍的效果。  单片机可以做什么 单片机：CPU、存储器、IO接口、定时器集成到一个硅片上，具有小而完整的微型计算机系统。 单片机使用灵活，经过二次硬件和软件开发，实现不同功能，满足不同需求。 硬件工程师：根据单片机资源设计硬件电路、原理图设计、PCB绘制、硬件功能调试。 软件工程师：单片机C语言基础、程序开发环境、程序的烧录、软件功能调试与测试。  单片机资源有哪些 STC15W104接口资源介绍：    名称 资源数量或大小 资源作用     工作电压 2.4-5.5V    程序空间（FLASH...</div></div></div></a><a class="pagination-related" href="/posts/36944.html" title="2.1.2.4-C语言函数的定义及调用"><div class="cover" style="background: #00000000"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-19</div><div class="info-item-2">2.1.2.4-C语言函数的定义及调用</div></div><div class="info-2"><div class="info-item-1"> C语言函数的定义及调用 函数语法结构： 1234返回参数变量类型 函数名（参数声明）&#123;    // 函数体&#125; 返回参数变量类型：char/unsigned char/int/unsigned int/float/double/… 定义主函数不要使用void，要用int，最后加上return 0。 函数名：英文字母或者下划线开头，可由英文字母、下划线和数字组成。 参数声明：可以说多个参数，也可以是无参数（void） 例1： 123456void Delay_1ms(void)    // 简单的延时函数，但因为没有指定单片机型号，所以i的大小并不准确&#123;    unsigned int i;    i = 1000;    while(i--);&#125; 例2： 12345int readkey(void)   // int函数示例&#123;    unsigned char KeyValue;    return KeyValue;&#125; 例3： 12345678void Delay_ms(unsigned int sec)&#123;...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="comment-switch"><span class="first-comment">Giscus</span><span id="switch-btn"></span><span class="second-comment">Livere</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div><div><div id="lv-container" data-id="city" data-uid="MTAyMC81ODkwMi8zNTM2NA=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text"> 硬件设计流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%89%A9%E6%96%99%E9%80%89%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text"> 关键物料选型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pcb%E8%AE%BE%E8%AE%A1%E8%BD%AF%E4%BB%B6altium-designer"><span class="toc-number">3.</span> <span class="toc-text"> PCB设计软件(Altium Designer)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E7%BA%BF%E9%97%A8%E7%A3%81%E6%8E%A2%E6%B5%8B%E5%99%A8%E5%8E%9F%E7%90%86%E5%9B%BE%E8%AE%BE%E8%AE%A1%E4%BB%A5%E5%8F%8A%E7%BB%98%E5%88%B6"><span class="toc-number">4.</span> <span class="toc-text"> 无线门磁探测器原理图设计以及绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B5%E6%BA%90%E6%A8%A1%E5%9D%97"><span class="toc-number">4.1.</span> <span class="toc-text"> 电源模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%A8%E7%A3%81%E5%BC%80%E5%85%B3%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9D%97"><span class="toc-number">4.2.</span> <span class="toc-text"> 门磁开关检测模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%B5%E6%B1%A0%E4%BD%8E%E5%8E%8B%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%9D%97"><span class="toc-number">4.3.</span> <span class="toc-text"> 电池低压检测模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%84%E9%A2%91%E6%A8%A1%E5%9D%97"><span class="toc-number">4.4.</span> <span class="toc-text"> 射频模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mcu%E7%94%B5%E8%B7%AF"><span class="toc-number">4.5.</span> <span class="toc-text"> MCU电路</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%B0%E5%88%B7%E7%94%B5%E8%B7%AF%E6%9D%BFpcb%E7%BB%98%E5%88%B6"><span class="toc-number">5.</span> <span class="toc-text"> 印刷电路板(PCB)绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E5%BA%93"><span class="toc-number">5.1.</span> <span class="toc-text"> 建库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 新建工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%98%E5%88%B6pcblib"><span class="toc-number">5.1.2.</span> <span class="toc-text"> 绘制PcbLib</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%98%E5%88%B6schlib"><span class="toc-number">5.1.3.</span> <span class="toc-text"> 绘制SchLib</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%8B%E5%88%9B%E5%95%86%E5%9F%8E%E7%A7%BB%E6%A4%8Dpcblib%E4%B8%8Eschlib%E8%8A%82%E7%BA%A6%E5%BB%BA%E5%BA%93%E6%97%B6%E9%97%B4"><span class="toc-number">5.1.4.</span> <span class="toc-text"> 立创商城移植PcbLib与SchLib，节约建库时间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%9B%BE%E7%BB%98%E5%88%B6"><span class="toc-number">5.2.</span> <span class="toc-text"> 原理图绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E6%AD%A5%E9%AA%A4%E6%A6%82%E8%BF%B0"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 绘制步骤概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%85%83%E5%99%A8%E4%BB%B6"><span class="toc-number">5.2.2.</span> <span class="toc-text"> 添加元器件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%85%83%E5%99%A8%E4%BB%B6"><span class="toc-number">5.2.3.</span> <span class="toc-text"> 连接元器件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E5%99%A8%E4%BB%B6%E7%BC%96%E5%8F%B7"><span class="toc-number">5.2.4.</span> <span class="toc-text"> 元器件编号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%8E%9F%E7%90%86%E5%9B%BE"><span class="toc-number">5.2.5.</span> <span class="toc-text"> 检查原理图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E8%A1%A8%E7%9A%84%E6%A6%82%E5%BF%B5fpga%E7%9B%B8%E5%85%B3"><span class="toc-number">5.3.</span> <span class="toc-text"> 网表的概念（FPGA相关）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pcb%E7%BB%98%E5%88%B6"><span class="toc-number">5.4.</span> <span class="toc-text"> PCB绘制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%8E%9F%E7%90%86%E5%9B%BE%E5%88%B0pcb"><span class="toc-number">5.4.1.</span> <span class="toc-text"> 导入原理图到PCB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E8%A7%84%E5%88%99"><span class="toc-number">5.4.2.</span> <span class="toc-text"> 建立规则</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E8%AE%BE%E8%AE%A1%E6%9E%81%E9%99%90%E8%AE%BE%E7%BD%AE"><span class="toc-number">5.4.2.1.</span> <span class="toc-text"> 工厂设计极限设置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%A0%E5%B1%82%E8%AE%BE%E8%AE%A1layer-stack-manager%E7%94%A8%E4%BA%8E%E8%AE%BE%E8%AE%A1%E5%A4%9A%E5%B1%82%E6%9D%BF"><span class="toc-number">5.4.2.2.</span> <span class="toc-text"> 叠层设计Layer Stack Manager（用于设计多层板）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pcb%E5%B8%83%E5%B1%80"><span class="toc-number">5.4.3.</span> <span class="toc-text"> PCB布局</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pcb%E5%B8%83%E7%BA%BF%E5%92%8C%E9%93%BA%E9%93%9C"><span class="toc-number">5.4.4.</span> <span class="toc-text"> PCB布线和铺铜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%84%E5%88%99%E6%A3%80%E6%9F%A5"><span class="toc-number">5.4.5.</span> <span class="toc-text"> 规则检查</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%BF%E6%A1%86%E5%A4%A7%E5%B0%8F%E8%AE%BE%E5%AE%9A%E5%AF%B9%E4%BA%8E%E6%9C%89%E5%85%AC%E7%89%88%E5%A4%96%E5%A3%B3%E7%9A%84%E4%BA%A7%E5%93%81%E9%9C%80%E8%A6%81%E6%94%BE%E5%9C%A8%E7%AC%AC%E4%B8%80%E6%AD%A5%E8%BF%9B%E8%A1%8C"><span class="toc-number">5.4.6.</span> <span class="toc-text"> 板框大小设定（对于有公版外壳的产品需要放在第一步进行）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bom%E6%96%87%E4%BB%B6%E6%95%B4%E7%90%86"><span class="toc-number">5.5.</span> <span class="toc-text"> BOM文件整理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8ad%E7%94%9F%E6%88%90bom%E8%A1%A8"><span class="toc-number">5.5.1.</span> <span class="toc-text"> 利用AD生成BOM表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%84%9A%E6%9C%AC%E7%94%9F%E6%88%90bom%E6%B8%85%E5%8D%95%E6%8E%A8%E8%8D%90"><span class="toc-number">5.5.2.</span> <span class="toc-text"> 利用脚本生成BOM清单（推荐）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E6%9D%BF%E6%96%87%E4%BB%B6%E7%9A%84%E8%BE%93%E5%87%BA"><span class="toc-number">5.6.</span> <span class="toc-text"> 打板文件的输出</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: #00000000;"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2024 By MagicConch</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>(() => {
  const panguFn = () => {
    if (typeof pangu === 'object') pangu.autoSpacingPage()
    else {
      btf.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
        .then(() => {
          pangu.autoSpacingPage()
        })
    }
  }

  const panguInit = () => {
    if (false){
      GLOBAL_CONFIG_SITE.isPost && panguFn()
    } else {
      panguFn()
    }
  }

  btf.addGlobalFn('pjaxComplete', panguInit, 'pangu')
  document.addEventListener('DOMContentLoaded', panguInit)
})()</script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'magic989/blog-comment',
      'data-repo-id': 'R_kgDOKIeUFQ',
      'data-category-id': 'DIC_kwDOKIeUFc4CY2P2',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo

  const loadLivere = (el, path) => {
    window.livereOptions = {
      refer: path || location.pathname
    }

    if (isShuoshuo) {
      window.shuoshuoComment.destroyLivere = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    if (typeof LivereTower === 'object') window.LivereTower.init()
    else {
      (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];
          if (typeof LivereTower === 'function') { return; }
          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;
          e.parentNode.insertBefore(j, e);
      })(document, 'script');
    }
  }

  if (isShuoshuo) {
    'Giscus' === 'Livere'
      ? window.shuoshuoComment = { loadComment: loadLivere }
      : window.loadOtherComment = loadLivere
    return
  }

  if ('Giscus' === 'Livere' || !false) {
    if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
    else loadLivere()
  } else {
    window.loadOtherComment = loadLivere
  }
})()</script></div><div class="aplayer no-destroy" data-id="8678600084" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-order="random" data-volume="0.3"> </div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["link[rel=\"canonical\"]","meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: true,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>